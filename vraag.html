<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Scavenger Hunt – Locatie-opdracht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050814;
      color: #f7f7ff;
      margin: 0;
      padding: 16px;
      display: flex;
      min-height: 100vh;
      box-sizing: border-box;
    }

    .wrapper {
      margin: auto;
      max-width: 480px;
      text-align: center;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .card {
      background: rgba(15, 18, 40, 0.92);
      border-radius: 24px;
      padding: 24px 22px 20px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.6);
      backdrop-filter: blur(12px);
      transition: background 0.4s ease, box-shadow 0.4s ease, transform 0.4s ease;
    }

    /* Groenige state bij succes */
    .card.success {
      background: radial-gradient(circle at top, rgba(107,255,181,0.16), rgba(15,18,40,0.98));
      box-shadow: 0 24px 70px rgba(0,0,0,0.9);
      transform: translateY(-2px);
    }

    .riddle {
      font-size: 2rem;
      line-height: 1.6;
      margin-bottom: 16px;
      opacity: 0.96;
      cursor: pointer; /* triple tap voor dev-modus */
    }

    .hint {
      font-size: 0.85rem;
      opacity: 0.85;
      margin-top: 8px;
      line-height: 1.4;
    }

    .status {
      font-size: 0.9rem;
      margin-top: 13px;
      min-height: 1.4em;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 12px 24px;
      font-size: 15px;
      cursor: pointer;
      margin-top: 16px;
      background: linear-gradient(135deg, #ffb3ff, #9f9cff);
      color: #141414;
      font-weight: 600;
    }

    /* DEV-SKIP knop */
    #dev-skip {
      display: none;
      margin-top: 10px;
      background: rgba(255,255,255,0.15);
      color: #fff;
      font-size: 14px;
    }

    /* INTRO OVERLAY */
    .intro-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255,255,255,0.06), transparent 55%), #050814;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .intro-box {
      max-width: 420px;
      padding: 28px 24px 24px;
      border-radius: 24px;
      background: rgba(5, 7, 18, 0.96);
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
      text-align: center;
      backdrop-filter: blur(14px);
    }

    .intro-text {
      font-size: 1.9rem;
      line-height: 1.45;
      font-weight: 500;
      margin: 0;
      opacity: 0;
    }

    .intro-text.fade-in {
      animation: introFade 0.8s ease forwards;
    }

    @keyframes introFade {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* FADE-OUT VAN HELE WRAPPER AAN HET EIND */
    .fade-out {
      animation: fadeOutScreen 1.4s ease forwards;
    }

    @keyframes fadeOutScreen {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0.97);
      }
    }
  </style>
</head>
<body>

  <!-- INTRO OVERLAY -->
  <div class="intro-overlay" id="intro-overlay">
    <div class="intro-box">
      <p id="intro-text" class="intro-text"></p>
    </div>
  </div>

  <div class="wrapper" id="main-wrapper">
    <div class="card" id="card">

      <p id="riddle" class="riddle">
        <em>“Ga naar de plek waar de hemel tastbaar lijkt.”</em>
      </p>

      <button id="dev-skip">DEV: Skip naar volgende</button>

      <p class="hint">
        Sta op de plek waar jij denkt te moeten zijn,<br/>
        en bevestig je locatie.
      </p>

      <button id="submit-btn">Bevestig locatie</button>

      <p id="status" class="status"></p>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    // 51°27'08.9"N 5°27'41.3"E → decimaal:
    const TARGET_LAT = 51.4524722;
    const TARGET_LON = 5.4614722;
    const RADIUS_METERS = 25;

    const NEXT_URL = "strijp.html";

    // ========= STATE / ELEMENTEN =========
    const submitBtn   = document.getElementById("submit-btn");
    const statusEl    = document.getElementById("status");
    const devSkipBtn  = document.getElementById("dev-skip");
    const riddleEl    = document.getElementById("riddle");
    const mainWrapper = document.getElementById("main-wrapper");
    const cardEl      = document.getElementById("card");

    const introOverlay = document.getElementById("intro-overlay");
    const introTextEl  = document.getElementById("intro-text");

    let devEnabled = false;

    // ========= INTRO SEQUENCE =========
    const introMessages = [
      "Ayo nice",
      "Goed gedaan",
      "Zou je hier willen wonen?",
      "Ohja, trouwens Emi",
      "Bedankt dat je bestaat :)"
    ];

    function runIntro() {
      let idx = 0;
      const DISPLAY_TIME = 3400;

      function nextMessage() {
        if (idx >= introMessages.length) {
          introOverlay.style.transition = "opacity 0.45s ease";
          introOverlay.style.opacity = "0";
          setTimeout(() => {
            introOverlay.style.display = "none";
            mainWrapper.style.opacity = "1";
            mainWrapper.style.transform = "translateY(0)";
          }, 450);
          return;
        }

        introTextEl.classList.remove("fade-in");
        void introTextEl.offsetWidth; // reflow
        introTextEl.textContent = introMessages[idx];
        introTextEl.classList.add("fade-in");

        idx++;
        setTimeout(nextMessage, DISPLAY_TIME);
      }

      nextMessage();
    }

    window.addEventListener("load", runIntro);

    // ========= HELPERS =========
    function toRad(x) { return x * Math.PI / 180; }

    function distanceInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371000;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
        Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function handleSuccess() {
      statusEl.textContent = "Lekker bro";
      submitBtn.disabled = true;
      cardEl.classList.add("success");

      // klein momentje de groene state laten zien, dan fade-out + redirect
      setTimeout(() => {
        mainWrapper.classList.add("fade-out");

        setTimeout(() => {
          window.location.href = NEXT_URL;
        }, 1400 + 1000); // zelfde timing als andere pagina's
      }, 1200);
    }

    // ========= LOCATIE-LOGICA =========
    submitBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        statusEl.textContent = "Locatie niet beschikbaar.";
        return;
      }

      statusEl.textContent = "Locatie wordt gecontroleerd…";

      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat  = pos.coords.latitude;
          const lon  = pos.coords.longitude;
          const dist = distanceInMeters(lat, lon, TARGET_LAT, TARGET_LON);

          if (dist <= RADIUS_METERS) {
            handleSuccess();
          } else {
            statusEl.textContent = `Fout, je zit er ${Math.round(dist)} meter vandaan.`;
          }
        },
        err => {
          statusEl.textContent = "Locatie ophalen mislukt.";
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    });

    // ========= DEV MODE (triple tap op het raadsel) =========
    let tapTimes = [];

    riddleEl.addEventListener("click", () => {
      const now = Date.now();
      tapTimes.push(now);

      if (tapTimes.length > 3) tapTimes.shift();

      if (tapTimes.length === 3 && tapTimes[2] - tapTimes[0] < 900) {
        devEnabled = true;
        devSkipBtn.style.display = "inline-block";
        statusEl.textContent = "(DEV-modus actief)";
      }
    });

    devSkipBtn.addEventListener("click", () => {
      window.location.href = NEXT_URL;
    });
  </script>
</body>
</html>
