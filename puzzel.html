<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Scavenger Hunt â€“ Puzzel</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"
  />
  <style>
    :root { color-scheme: dark; }

    html, body {
      margin: 0; padding: 0; height: 100%;
      overflow: hidden;
    }

    body {
      font-family: system-ui, sans-serif;
      background: #050814;
      color: #f7f7ff;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: none;
    }

    .wrapper {
      max-width: 480px;
      width: calc(100vw - 32px);
      text-align: center;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .4s ease, transform .4s ease;
    }

    .card {
      background: rgba(15,18,40,.92);
      border-radius: 24px;
      padding: 24px 22px;
      box-shadow: 0 18px 60px rgba(0,0,0,.6);
      backdrop-filter: blur(12px);
      transition: opacity .7s ease, transform .6s ease;
    }

    .card.solved {
      background: radial-gradient(circle at top, rgba(107,255,181,.16), rgba(15,18,40,.98));
      box-shadow: 0 24px 80px rgba(0,0,0,.9);
      transform: translateY(-2px);
    }

    .card.fade-out {
      opacity: 0;
      transform: scale(.97);
    }

    .question {
      font-size: 1.1rem;
      margin-bottom: 12px;
      opacity: .96;
      cursor: pointer; /* dev mode */
    }

    .puzzle-area {
      position: relative;
      width: 240px;
      height: 340px;
      margin: 0 auto;
      touch-action: none;
    }

    .board {
      position: absolute;
      width: 240px; height: 240px;
      border-radius: 20px;
      background: radial-gradient(circle at top, rgba(255,255,255,.10), #141726);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 0 14px rgba(0,0,0,.9), inset 0 0 22px rgba(0,0,0,.8);
      overflow: hidden;
      pointer-events: none;
    }

    .tray-hint {
      position: absolute;
      inset: auto 0 0 0;
      height: 90px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(255,255,255,.06), #0b0d19);
      border: 1px solid rgba(255,255,255,.06);
      opacity: .7;
      pointer-events: none;
    }

    .piece {
      position: absolute;
      width: 60px; height: 60px;
      background-image: url("puzzel.png");
      background-size: 240px 240px;
      border-radius: 8px;
      box-shadow: 0 12px 30px rgba(0,0,0,.8);
      cursor: grab;
      transition: box-shadow .15s ease, transform .15s ease;
      touch-action: none;
      z-index: 2;
    }

    .piece:active {
      cursor: grabbing;
      transform: scale(1.03);
      box-shadow: 0 16px 40px rgba(0,0,0,.9);
    }

    .piece.locked {
      cursor: default;
      box-shadow: 0 0 14px rgba(107,255,181,.9);
      z-index: 1;
    }

    .piece.locked-pop {
      animation: pop .18s ease-out;
    }

    @keyframes pop {
      0%{transform:scale(1);}
      50%{transform:scale(1.06);}
      100%{transform:scale(1);}
    }

    .status {
      font-size: .9rem;
      margin-top: 10px;
      min-height: 1.4em;
      opacity: .9;
    }

    #dev-skip {
      display: none;
      margin-top: 10px;
      border-radius: 999px;
      padding: 8px 16px;
      background: rgba(255,255,255,.15);
      color: #fff;
      border: none;
      font-size: 14px;
      cursor: pointer;
    }

    /* INTRO */
    .intro-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255,255,255,.06), transparent 55%), #050814;
      display: flex;
      align-items: center; justify-content: center;
      z-index: 10;
    }

    .intro-box {
      max-width: 420px;
      padding: 28px 24px;
      border-radius: 24px;
      background: rgba(5,7,18,.96);
      box-shadow: 0 20px 60px rgba(0,0,0,.8);
      text-align: center;
      backdrop-filter: blur(14px);
    }

    .intro-text {
      font-size: 1.9rem;
      line-height: 1.45;
      opacity: 0;
      margin: 0;
    }

    .intro-text.fade-in {
      animation: introFade .8s ease forwards;
    }

    @keyframes introFade {
      from {opacity:0; transform:translateY(6px);}
      to   {opacity:1; transform:translateY(0);}
    }
  </style>
</head>
<body>

  <!-- INTRO -->
  <div class="intro-overlay" id="intro-overlay">
    <div class="intro-box">
      <p id="intro-text" class="intro-text"></p>
    </div>
  </div>

  <div class="wrapper" id="wrapper">
    <div class="card" id="card">

      <p id="question" class="question">Los de puzzel op.</p>

      <div id="puzzle-area" class="puzzle-area">
        <div class="board"></div>
        <div class="tray-hint"></div>
      </div>

      <p id="status" class="status"></p>

      <button id="dev-skip">DEV: Skip naar volgende</button>

    </div>
  </div>

<script>
  /* CONFIG */
  const ROWS=4, COLS=4;
  const BOARD_SIZE=240;
  const SHELL_HEIGHT=340;
  const TRAY_TOP=BOARD_SIZE+10;
  const TRAY_HEIGHT=SHELL_HEIGHT-TRAY_TOP-10;
  const PIECE_W=BOARD_SIZE/COLS;
  const PIECE_H=BOARD_SIZE/ROWS;
  const SNAP_DISTANCE=14;

  const NEXT_URL="discopaal.html";

  const wrapper=document.getElementById("wrapper");
  const puzzleArea=document.getElementById("puzzle-area");
  const card=document.getElementById("card");
  const statusEl=document.getElementById("status");
  const devSkip=document.getElementById("dev-skip");
  const question=document.getElementById("question");

  const introOverlay=document.getElementById("intro-overlay");
  const introText=document.getElementById("intro-text");

  let pieces=[];
  let placedCount=0;
  const lockedGrid=[...Array(ROWS)].map(()=>Array(COLS).fill(false));

  /* INTRO */
  const introMessages=[
    "Enne?",
    "Ja hoi je spreekt met Job",
    "Emi kan je me helpen",
    "Ik heb geen diploma"
  ];

  function runIntro(){
    let idx=0;
    const DISPLAY=3400;
    function next(){
      if(idx>=introMessages.length){
        introOverlay.style.transition="opacity .45s";
        introOverlay.style.opacity="0";
        setTimeout(()=>{
          introOverlay.style.display="none";
          wrapper.style.opacity="1";
          wrapper.style.transform="translateY(0)";
        },450);
        return;
      }
      introText.classList.remove("fade-in");
      void introText.offsetWidth;
      introText.textContent=introMessages[idx];
      introText.classList.add("fade-in");
      idx++;
      setTimeout(next,DISPLAY);
    }
    next();
  }

  /* PUZZEL */
  function initPuzzle(){
    const positions=[];
    for(let r=0;r<ROWS;r++){
      for(let c=0;c<COLS;c++){
        positions.push({r,c});
      }
    }

    const shuffled=[...positions].sort(()=>Math.random()-0.5);

    positions.forEach((p,i)=>{
      const piece=document.createElement("div");
      piece.className="piece";
      piece.dataset.row=p.r;
      piece.dataset.col=p.c;

      piece.style.backgroundPosition=`${-p.c*PIECE_W}px ${-p.r*PIECE_H}px`;

      const start=shuffled[i];
      let left=start.c*PIECE_W + (Math.random()-0.5)*12;
      let top =TRAY_TOP    + (Math.random()-0.5)*12;

      left=Math.max(0,Math.min(left,BOARD_SIZE-PIECE_W));
      top =Math.max(TRAY_TOP,Math.min(top,TRAY_TOP+TRAY_HEIGHT-PIECE_H));

      piece.style.left=`${left}px`;
      piece.style.top =`${top}px`;

      enableDrag(piece);
      puzzleArea.appendChild(piece);
      pieces.push(piece);
    });
  }

  function enableDrag(piece){
    let offX=0, offY=0, dragging=false;

    piece.addEventListener("pointerdown",e=>{
      if(piece.classList.contains("locked")) return;
      dragging=true;
      piece.setPointerCapture(e.pointerId);

      puzzleArea.appendChild(piece);

      const rect=piece.getBoundingClientRect();
      offX=e.clientX-rect.left;
      offY=e.clientY-rect.top;
    });

    piece.addEventListener("pointermove",e=>{
      if(!dragging)return;
      const areaRect=puzzleArea.getBoundingClientRect();

      let left=e.clientX-areaRect.left-offX;
      let top =e.clientY-areaRect.top -offY;

      left=Math.max(0,Math.min(left,BOARD_SIZE-PIECE_W));
      top =Math.max(0,Math.min(top,SHELL_HEIGHT-PIECE_H));

      piece.style.left=`${left}px`;
      piece.style.top =`${top}px`;
    });

    piece.addEventListener("pointerup",e=>{
      dragging=false;
      piece.releasePointerCapture(e.pointerId);
      checkSnap(piece);
    });

    piece.addEventListener("pointercancel",e=>{
      dragging=false;
      piece.releasePointerCapture(e.pointerId);
    });
  }

  function checkSnap(piece){
    const r=parseInt(piece.dataset.row);
    const c=parseInt(piece.dataset.col);

    const targetL=c*PIECE_W;
    const targetT=r*PIECE_H;

    const curL=parseFloat(piece.style.left);
    const curT=parseFloat(piece.style.top);

    if(curT+PIECE_H/2>BOARD_SIZE) return; // center onder bord

    const dx=curL-targetL;
    const dy=curT-targetT;
    const dist=Math.sqrt(dx*dx+dy*dy);

    if(dist<=SNAP_DISTANCE){
      if(lockedGrid[r][c]) return;

      piece.style.left=`${targetL}px`;
      piece.style.top =`${targetT}px`;
      piece.classList.add("locked","locked-pop");
      lockedGrid[r][c]=true;
      placedCount++;

      setTimeout(()=>piece.classList.remove("locked-pop"),220);

      checkComplete();
    }
  }

  function checkComplete(){
    if(placedCount===pieces.length){
      card.classList.add("solved");

      setTimeout(()=>{
        card.classList.add("fade-out");
        setTimeout(()=>{ window.location.href=NEXT_URL; },1400);
      },1500);
    }
  }

  /* DEV MODE */
  let taps=[];
  question.addEventListener("click",()=>{
    const now=Date.now();
    taps.push(now);
    if(taps.length>3)taps.shift();

    if(taps.length===3 && taps[2]-taps[0]<900){
      devSkip.style.display="inline-block";
      statusEl.textContent="(DEV-modus actief)";
    }
  });

  devSkip.addEventListener("click",()=>window.location.href=NEXT_URL);

  /* INIT */
  window.addEventListener("load",()=>{
    runIntro();
    initPuzzle();
  });
</script>

</body>
</html>
